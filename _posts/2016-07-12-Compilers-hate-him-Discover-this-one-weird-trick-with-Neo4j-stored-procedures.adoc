# Compilers hate him! Discover this one weird trick with Neo4j stored procedures

As you probably already know, Neo4j 3.0 finally comes with https://neo4j.com/docs/java-reference/current/#_calling_procedure[stored procedures] (let's call them sprocs from now on).

The cool thing about this is you can directly interact with sprocs in Cypher, as https://twitter.com/mesirii[Michael Hunger] explains in this  https://neo4j.com/blog/intro-user-defined-procedures-apoc/[blog post].

## Writing stored procedures

During the preparation of my Neo4j in the latest https://www.facebook.com/GoCriteo/photos/pcb.1045385882181102/1045385698847787/?type=3[Criteo summit] (we're http://www.criteo.com/careers/#careers-browser[hiring]!), I started playing around with sprocs.

The process is quite simple:

 1. You write some code, annotate it
 2. test it with the test harness
 3. deploy it to your Neo4j instance and that's it!
 
Actually, step 3 may repeat itself quite a few times, Neo4j sprocs must comply to a few rules before your Neo4j server accepts to deploy it.

## Sproc rules

While rules are detailed in `@org.neo4j.procedure.Procedure` https://github.com/neo4j/neo4j/blob/3.0/community/kernel/src/main/java/org/neo4j/procedure/Procedure.java#L31[javadoc], we can summarize the rules as follows:

 - a sproc is a method annotated with `@org.neo4j.procedure.Procedure`
 - it must return a https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html[`java.util.stream.Stream<T>`] where T is a user-defined record type
 - if the sproc accepts parameters, they all must be annotated with `@Name`