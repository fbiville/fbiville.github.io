<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Neo4j : mais qu&#x27;est-ce que c&#x27;est ?</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="//fbiville.github.io/themes/Casper/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//fbiville.github.io/themes/Casper/assets/css/screen.css?v=1.0.0" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html" />
    
    <meta property="og:site_name" content="(10 piece) Puzzler" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Neo4j : mais qu&#x27;est-ce que c&#x27;est ?" />
    <meta property="og:description" content="Les graphes sont partout et il y a une bonne raison à cela : il s&amp;#8217;agit de l&amp;#8217;une des structures de données les plus génériques qui existent dans notre panoplie de développeur. Tellement générique qu&amp;#8217;elle..." />
    <meta property="og:url" content="https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html" />
    <meta property="article:published_time" content="2013-10-12T22:00:00.000Z" />
    <meta property="article:modified_time" content="2015-05-09T12:22:46.633Z" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Neo4j : mais qu&#x27;est-ce aue c&#x27;est ?" />
    <meta name="twitter:description" content="Les graphes sont partout et il y a une bonne raison à cela : il s&amp;#8217;agit de l&amp;#8217;une des structures de données les plus génériques qui existent dans notre panoplie de développeur. Tellement générique qu&amp;#8217;elle..." />
    <meta name="twitter:url" content="https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "(10 piece) Puzzler",
    "author": {
        "@type": "Person",
        "name": "@fbiville",
        "image": "https://avatars.githubusercontent.com/u/445792?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "http://florent.biville.net"
    },
    "headline": "Neo4j : mais qu&#x27;est-ce que c&#x27;est ?",
    "url": "https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html",
    "datePublished": "2013-10-12T22:00:00.000Z",
    "dateModified": "2015-05-09T12:22:46.633Z",
    "description": "Les graphes sont partout et il y a une bonne raison à cela : il s&amp;#8217;agit de l&amp;#8217;une des structures de données les plus génériques qui existent dans notre panoplie de développeur. Tellement générique qu&amp;#8217;elle..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="(10 piece) Puzzler" href="https://fbiville.github.io/rss" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
</head>
<body class="post-template">

    


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="https://fbiville.github.io">Home</a>
        <!-- <a class="subscribe-button icon-feed" href="https://fbiville.github.io/rss/">Subscribe</a> -->
    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Neo4j : mais qu&#x27;est-ce que c&#x27;est ?</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2013-10-13">13 October 2013</time> 
            </section>
        </header>

        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Les graphes sont partout et il y a une bonne raison à cela : il s&#8217;agit
de l&#8217;une des structures de données les plus génériques qui existent dans
notre panoplie de développeur. Tellement générique qu&#8217;elle se retrouve
dans de nombreux domaines métier.</p>
</div>
<div class="paragraph">
<p>En témoigne un concours clos récemment : le
<a href="http://www.neo4j.org/learn/graphgist_challenge">GraphGist challenge</a>.</p>
</div>
<div class="paragraph">
<p>La notion de <a href="https://gist.github.com/">gist</a> a été popularisée par
<a href="https://www.github.com/">Github</a>. Le terme signifie littéralement "idée
générale" et consiste, dans le cas de Github, à partager un bout de code
à d&#8217;autres personnes.</p>
</div>
<div class="paragraph">
<p>La notion de <a href="http://gist.neo4j.org/">GraphGist</a> s&#8217;en inspire largement et
laisse l&#8217;utilisateur saisir quelques requêtes typiques d&#8217;un graphe,
agrémentées de commentaires. Basée sur <a href="http://console.neo4j.org" class="bare">http://console.neo4j.org</a>, la
console interactive de Neo4J, vous pourrez alors exécuter les requêtes
saisies voire les modifier si l&#8217;envie vous en prend.</p>
</div>
<div class="paragraph">
<p>Sans en aller jusque là, je vous invite tout de même à consulter les
<a href="https://github.com/neo4j-contrib/graphgist/wiki">contributions</a> du
concours et vous constaterez à quel point elles sont diverses : n&#8217;est-ce
pas là la meilleure preuve qu&#8217;une base de données graphe peut vous
dépanner dans de nombreuses situations ?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nom_neo4j_fonction_base_de_donn_es_graphe">Nom : Neo4J, fonction : base de données graphe</h3>
<div class="paragraph">
<p>Revenons aux fondamentaux : Neo4J est une base de données
<a href="http://fr.wikipedia.org/wiki/Propri%C3%A9t%C3%A9s_ACID">ACID-compliant</a>
orientée graphe. Elle persiste, comme son nom peut le suggérer, des
noeuds et des relations.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://lh4.googleusercontent.com/n_tOS-0poKPC8Bma1P3N9kbzQczOQw_wnbX0tt4m32gPZX9nF7_OOgRjTba51sA8QbY04Na2KQdNlHiA-v20dXmGUexI4uvVjnAPs7niE3JfIeeGYFU0lwSLzw" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Base de données, vous connaissez : PostgreSQL, Oracle sont des exemples
bien connus de base de données relationnelles. D&#8217;ailleurs, pourquoi ne
retrouve-t&#8217;on pas le terme "relationnel" pour les bases de données
graphe ?</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://lh3.googleusercontent.com/gNPP3UXguHPCv-sTTn2TTHNWLZtRrMMsuJwPd0mozfQO5wPcNl_aAiQiPp2s2zV8dz6RzeipuLfnF5ABqxp082W9T29AfbJduj7jfM8GhvEOWC4cGxo4NSCELA" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Dans le cas de nos bons vieux SGDBR, le terme relationnel prend ses
racines dans la théorie de l&#8217;algèbre dite (elle aussi, comme c&#8217;est
étrange) relationnelle, laquelle fut fondée fondée par Edgar Frank Codd
(voir photo précédente) en 1970 (oui, oui, la même année que
<a href="http://www.youtube.com/watch?v=huZFThnetjo">ça</a>). (Tiens, d&#8217;ailleurs,
vous savez pourquoi le mouvement NOSQL s&#8217;endort : parce que Codd est in
!). L&#8217;algèbre relationnelle formalise une série d&#8217;opérations applicables
à des ensembles, lesquels sont fixés par un schéma qui leur est propre.</p>
</div>
<div class="paragraph">
<p>Et donc à y regarder de plus près, Neo4J n&#8217;est donc pas une base de
données relationnelle <em>stricto sensu</em> : aucun schéma n&#8217;est requis ! Si
vous souhaitez semi-structurer vos données, cette tâche vous revient.</p>
</div>
<div class="paragraph">
<p>Concernant ce dernier point, notez tout de même qu&#8217;entre la V1 et la V2,
Neo4J est passé du rang <em>"schemaless"</em> à <em>"schema-optional"</em>. Cette
version 2, en cours de finalisation, promeut une nouvelle notion : les
<a href="http://docs.neo4j.org/chunked/milestone/graphdb-neo4j-labels.html">labels</a>.
Vous pouvez maintenant regrouper vos noeuds par famille. Un noeud
représentant par exemple un chien pourra se voir apposé les labels
"canidé", "mammifère" et "animal".</p>
</div>
<div class="paragraph">
<p>Un label n&#8217;est rien d&#8217;autre qu&#8217;une étiquette. Deux noeuds libellés de la
même façon pourront contenir des propriétés potentiellement différentes.
Neo4J reste avant une base de données sans schema. Les labels sont juste
une manière très légère de donner plus de sens à vos données. N&#8217;hésitez
à regarder ce court <a href="http://www.neo4j.org/develop/labels"><em>screencast</em></a>
d&#8217;introduction.</p>
</div>
<div class="sect3">
<h4 id="_neo4j_persiste_des_em_property_graphs_em">Neo4J persiste des <em>property graphs</em></h4>
<div class="paragraph">
<p>Le graphe est une structure de données tellement riche, tellement variée
qu&#8217;il serait faux de croire que toutes les typologies de graphe du monde
sont supportées.</p>
</div>
<div class="paragraph">
<p>À l&#8217;instar du
<a href="https://github.com/tinkerpop/blueprints/wiki/Property-Graph-Model">modèle</a>
poussé par la spécification Blueprints de Tinkerpop, Neo4J supporte
uniquement le <em>property graph</em>. Comme dans tout graphe, nous disposons
de noeuds (<em>nodes</em>, <em>vertices</em>) et éventuellement de relations
(<em>relationships</em>, <em>edges</em>,<em>arcs</em>) orientées ou non. Chacun de ces
deux types d'élements peuvent être constitués de 0 à n paires de
clefs-valeurs (comme l&#8217;illustre l&#8217;image ci-dessous).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://lh4.googleusercontent.com/oDnT0mVQO6YJ6XJ6SW0fEGnTdL8LWyw2a3-mFR1pjbHGxI6BrfLOha3iLhGjAyE30leiugTZI_PyaOUCJoaMneyAKJpin0hxbWVx86Z8uehz71H_7BOqrGNfRw" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Vous l&#8217;aurez compris, ce graphe décrit les relations entre différents
personnages de Matrix (film tellement culte qu&#8217;il a largement inspiré le
nom Neo4J). Les chiffres représentent les IDs techniques des noeuds.</p>
</div>
<div class="paragraph">
<p>Les noeuds (ronds) contiennent un nombre varié de propriétés (bloc gris)
et se joignent par des relations (lignes pointillées) avec un type (ici
KNOWS et CODED_BY). Rien n&#8217;indique que nous ayons à faire à des
personnages ici, puisque qu&#8217;aucun noeud n&#8217;a exactement la même structure
(certains ont une propriété last name, d&#8217;autres une propriété language).
De même, bien que la grande majorité des relations ici soit libellée
KNOWS, certaines n&#8217;ont pas de propriétés, d&#8217;autres une propriété
disclosure&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>C&#8217;est par une lecture plus globale que l&#8217;on comprend ce que le graphe
représente. L&#8217;aspect schéma-optionnel peut paraître déroutant, mais une
fois dompté, il vous permet d&#8217;intégrer un nombre d&#8217;informations utiles
là où cela fait sens (rappelez-vous cette colonne supplémentaire que
vous avez ajoutée à votre table et dont la valeur est NULL pour 90% des
enregistrements).</p>
</div>
<div class="paragraph">
<p>Un <em>property graph</em>, bien que très flexible, impose quelques
contraintes : ses noeuds et relations doivent être identifiés de façon
globalement unique (ce sont les IDs techniques dont je vous parlais). En
outre, ses relations doivent nécessairement comprendre un noeud de
départ (<em>tail</em>) et d&#8217;arrivée (<em>head</em>), potentiellement non
distincts. En d&#8217;autres termes, un noeud peut avoir une relation avec
lui-même (et je prie tout esprit malsain de s&#8217;abstenir de commentaires
douteux).</p>
</div>
<div class="paragraph">
<p>Quoi qu&#8217;il en soit, le modèle de Neo4J est simple, ses concepts se
comptent sur les doigts d&#8217;une main (noeuds, relations, propriétés,
labels). Il existe d&#8217;autres types de graphes non supportés par Neo et
qui ont aussi leur utilité.</p>
</div>
</div>
<div class="sect3">
<h4 id="_un_mod_le_de_persistence_orient_graphe_diff_rent_em_le_triplestore_em">Un modèle de persistence orienté graphe différent : <em>le triplestore</em></h4>
<div class="paragraph">
<p>La spécification
<a href="http://fr.wikipedia.org/wiki/Resource_Description_Framework">RDF</a> du W3C
décrit un autre modèle de graphe, destiné à représenter les ressources
sur le Web et leurs métadonnées. Un document persisté dans un store RDF
est un ensemble de triplets (sujet, prédicat, objet). L&#8217;intérêt d&#8217;une
telle formalisation est de pouvoir formuler des requêtes intelligentes
permettant d&#8217;obtenir les données qui nous sont le plus pertinentes (via
le langage de requêtage standardisé SPARQL par exemple).</p>
</div>
<div class="paragraph">
<p>Ayant honteusement pompé la documentation
d&#8217;<a href="http://www.franz.com/agraph/allegrograph/">AllegroGraph</a> (une base de
données graphe conforme à RDF), je vous invite à regarder l&#8217;exemple
trivial suivant :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://lh5.googleusercontent.com/XnkjhxAd62wOEyq5mf_zhdZcCxYNL6tysMVDHgxJa2PZHzQPvcqFhy5KDmjWGTakDd9883UnVyYvyyRrvPBAFLRFsEtnpwEb0Zlh3ZM63uGqdH7XcCkr7o7H1g" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Un exemple de triplets issus de ce graphe pourrait être :</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: %;">
<col style="width: %;">
<col style="width: %;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sujet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prédicat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">objet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Human</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Robbie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Robbie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PetOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PetOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">InverseOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HasPet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SubClassOf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mammal</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Une fois persisté, vous pourrez donc formuler des requêtes type "sujet =
Jans" ou encore "type = PetOf, objet = Jans" afin de récupérer le ou les
triplets correspondants.</p>
</div>
<div class="paragraph">
<p>Si le sujet vous intéresse, n&#8217;hésitez pas consulter les ressources
suivantes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Qu&#8217;est-ce que RDF ? <a href="http://www.w3.org/TR/rdf-primer/" class="bare">http://www.w3.org/TR/rdf-primer/</a></p>
</li>
<li>
<p>Documentation
d&#8217;<a href="http://www.franz.com/agraph/support/documentation/current/agraph-introduction.html">AllegroGraph</a></p>
</li>
<li>
<p>Tutoriaux pour et par
<a href="http://jena.apache.org/tutorials/index.html">Apache Jena</a></p>
</li>
<li>
<p>et bien d&#8217;autres !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comme je vous le disais, Neo4J ne supporte pas cette notion de triplet
(une relation n&#8217;affecte que deux noeuds maximum). Il existe cependant
différentes façons de contourner cette limitation :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>introduire un noeud factice, lui-même lié aux trois noeuds qui vous
intéresse</p>
</li>
<li>
<p>regarder du côté de
<a href="https://github.com/neo4j-contrib/neo4j-rdf">Neo4j-RDF</a>, un module
communautaire</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Mais cela devient déjà fastidieux, alors imaginez une seconde essayer de
persister un <a href="http://fr.wikipedia.org/wiki/Hypergraphe">hypergraphe</a> avec
Neo4J et vous comprendrez votre douleur. S&#8217;il y a bien une idée qui doit
ressortir de NOSQL (plutôt que "remplaçons MySQL par MongoDB") est
"chaque base a son usage", donc n&#8217;allez pas coller Neo4J n&#8217;importe où
non plus ;-)</p>
</div>
<div class="paragraph">
<p>Son modèle est certes très simple et souffre de quelques limitations
théoriques, mais cette base de données sait très bien s&#8217;adapter à un
large panel de situations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_qui_utilise_neo4j">Qui utilise Neo4J ?</h3>
<div class="paragraph">
<p>Et pour bien comprendre la variété des cas d&#8217;utilisation candidats à une
utilisation de Neo, il suffit de lister les domaines métier des
<a href="http://www.neotechnology.com/customers/">utilisateurs officiels</a> (on y
retrouve de l&#8217;aéronautique et des coopératives agricoles en passant par
les télécoms et la <a href="http://bio4j.com/">biologie</a>). Je ne saurai prétendre
à l&#8217;exhaustivité, prenons toutefois l&#8217;exemple français de Viadeo.</p>
</div>
<div class="paragraph">
<p>Disclaimer : je n&#8217;ai pas travaillé avec cette entreprise, cela ne
reflète aucunement le travail qui a été mis en oeuvre dans cette
société.</p>
</div>
</div>
<div class="sect2">
<h3 id="_viadeo_neo4j_comme_moteur_de_recommandations">Viadeo : Neo4J comme moteur de recommandations</h3>
<div class="paragraph">
<p><span class="image"><img src="https://lh5.googleusercontent.com/tMhBpya1njHQk1vqB8lwNQ_7gmoeZ7dzrerRkT2wPaCs1KmI2wyCnzj85KKTQow8H7o5oIpgnE9w8qR3ZG5QBEsXy-2pZKwgXotCqArBd6QorJrO44-zGZ5MYA" alt="image"></span></p>
</div>
<div class="paragraph">
<p><a href="http://fr.viadeo.com/">Viadeo</a> est un réseau social professionnel,
permettant de mettre en relation deux personnes partageant (le plus
souvent) au moins une expérience professionnelle commune. Leur moteur
initial de recommandations rencontrait de plus en plus de difficultés :
plus ça allait, plus le batch de calcul de recommandations requiérait du
temps&#8230;&#8203; jusqu&#8217;au point de non-retour ou y dédier un week-end complet ne
suffisait plus. Mais Neo4J vint à la rescousse !</p>
</div>
<div class="paragraph">
<p>Imaginez donc que vous soyez recrutés pour réaliser cette nouvelle
version du moteur de recommandations. Votre mission, si vous l&#8217;acceptez,
est de réaliser un prototype permettant de stocker un ensemble de
contacts, d&#8217;entreprises. Chaque contact peut avoir travaillé pour une ou
plusieurs entreprises et peut être en contact direct avec d&#8217;autres
personnes.</p>
</div>
<div class="paragraph">
<p>Avant d'ébaucher le modèle, vous vous rendez compte qu&#8217;il vous est
nécessaire de vous former rapidement au langage de requêtage privilégié
de Neo4J : Cypher.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cypher_crash_course">Cypher crash course</h3>
<div class="paragraph">
<p>Cypher a pour rôle de requêter des données sur Neo4J (en plus d'être un
traître dans le premier volet de Matrix). Déclaratif, Cypher vous laisse
décrire la forme du résultat qui vous intéresse et les contraintes que
vous souhaitez y ajouter : c&#8217;est lui qui se chargera d&#8217;optimiser le plan
d&#8217;exécution pour récupérer vos résultats.</p>
</div>
<div class="sect3">
<h4 id="_anatomie_d_une_requ_te_en_lecture">Anatomie d&#8217;une requête en lecture</h4>
<div class="paragraph">
<p>Pour lire de la donnée, vous suivrez donc 4 étapes :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>clause START : définition du ou des points de départ dans votre
graphe. Ce peut être des noeuds ou des relations. Mieux vous ciblez vos
points de départ, moins vous aurez de données à traverser et plus
performante votre requête sera (et de plus en plus comme Yoda je
m&#8217;exprime). Note : depuis la v2, cette clause peut la plupart du temps
être omise.</p>
</li>
<li>
<p>clause MATCH : c&#8217;est ici que tout se joue ! Vous décrivez la petite
portion du graphe qui vous intéresse (par exemple :"les noeuds de label
ZOMBIE qui sont en relation FRIEND_WITH avec les noeuds de label PLANT
eux-mêmes en relation FARMED_BY avec des noeuds de label HUMAN"). Notez
qu&#8217;il est
<a href="http://www.javacodegeeks.com/2013/01/optimizing-neo4j-cypher-queries.html"><strong>très
fortement conseillé</strong></a> de ne spécifier ici que ce qui vous sera utile
pour le résultat. Si par exemple, vous ne souhaitez retourner que des
noeuds de label HUMAN et ZOMBIE, alors déportez le reste dans la clause
de filtrage WHERE, (ce qui donne "les noeuds de label ZOMBIE
indirectement liés aux noeuds de label HUMAN pour lesquels (WHERE) il
existe une relation FRIEND_WITH des noeuds de label PLANT avec une
relation FARMED_BY").</p>
</li>
<li>
<p>clause WHERE : à l&#8217;instar d&#8217;une requête SQL, vous rédigez ici vos
prédicats permettant de réduire (filtrer) le nombre d&#8217;enregistrements à
ce qui vous intéresse. Basé sur l&#8217;exemple précédent, nous pourrions nous
intéresser uniquement aux noeuds HUMAN dont le nom est "Florent Biville"
par exemple.</p>
</li>
<li>
<p>clause RETURN : c&#8217;est évidemment ici que vous spécifiez l&#8217;expression
qui décrit le résultat qui vous intéresse. Cette expression peut être
simple (un ensemble de variables déclarées dans les clauses précédentes)
ou plus complexes (utilisation d&#8217;opérateurs
d&#8217;<a href="http://docs.neo4j.org/chunked/milestone/query-aggregation.html">aggrégation</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Je ne traite ici que la partie lecture (en omettant d&#8217;ailleurs certaines
clauses comme LIMIT, ORDER BY et, une clause introduite plus récemment,
WITH qui agit comme un <em>pipe</em> Unix entre différentes requêtes).</p>
</div>
</div>
<div class="sect3">
<h4 id="_description_de_patterns_match_l_ascii_art_au_service_du_graphe">Description de patterns (MATCH) : l&#8217;ASCII Art au service du graphe</h4>
<div class="paragraph">
<p>Rappelez-vous du <em>property graph</em> précédent :</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://lh3.googleusercontent.com/2XrmgbjrUXhdLVpEPqEO34PYD9a318K2FDpx8Bo7tuzbA3fG1L3VI1RTeujEfxJGbIcs9q2BuP15wUdMKu29ihI5KvGVXRzkwDg1Mp3hXh-L_0tO9UxizmhLqQ" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Les graphes sont souvent dépeints avec des "ronds" pour les noeuds et
des "flèches" pour les relations. Tout en prenant soin de ne pas trop
s'éloigner de la triste réalité de nos claviers, Cypher tente toute de
même de se rapprocher de cette symbolique (hein,
<a href="https://github.com/bodil/BODOL">BODOL</a>!).</p>
</div>
<div class="paragraph">
<p>La façon la plus simple/rapide de décrire un rond (et donc un noeud) ?
()</p>
</div>
<div class="paragraph">
<p>La façon la plus simple/rapide de décrire une flècle (et donc une
relation) ? -&#8594;</p>
</div>
<div class="paragraph">
<p>Épiçons un peu.</p>
</div>
<div class="paragraph">
<p>Une relation orientée / non-orientée entre deux noeuds ? ()-&#8594;() /
()--()</p>
</div>
<div class="paragraph">
<p>Trois noeuds joints par deux relations orientées ? ()-&#8594;()-&#8594;()</p>
</div>
<div class="paragraph">
<p>Un noeud de label HUMAN ? (:HUMAN)</p>
</div>
<div class="paragraph">
<p>Un noeud avec les labels GEEK et NERD ? (:GEEK:NERD)</p>
</div>
<div class="paragraph">
<p>Une relation non-orientée de type IDYLLIC ? (:HUMAN)-[:IDYLLIC]-(:HUMAN)</p>
</div>
<div class="paragraph">
<p>Nous y sommes presque. Reste un point épineux : comment fais-je
référence à ces jolis patterns dans les clauses suivantes de ma requête
?</p>
</div>
<div class="paragraph">
<p>Par des noms de variable pardi !</p>
</div>
<div class="paragraph">
<p>Prenons un exemple de requête complète :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher"> MATCH (flo:HUMAN:MALE)-[luv:LOVES]-(didi:HUMAN:FEMALE
 WHERE flo.firstName = 'Florent' AND didi.firstName = '...' // ;-)
 RETURN flo, didi, luv.since</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme vous le voyez, vous pouvez utiliser à peu près n&#8217;importe quel nom
de variable, que vous pourrez reprendre ensuite dans d&#8217;autres clauses
afin de définir et affiner le résultat. (Ah oui, et la requête répond à
"Qui aime et est aimé par Florent et depuis quand ?").</p>
</div>
<div class="paragraph">
<p>Il existe bien d&#8217;autres aspects que je n&#8217;ai pas décrits ici :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>opérateurs (NOT, IN, &#8230;&#8203;)</p>
</li>
<li>
<p>aggrégation</p>
</li>
<li>
<p>requêtes d'écriture</p>
</li>
<li>
<p>indexation</p>
</li>
<li>
<p>les alternatives à Cypher : le <a href="http://docs.neo4j.org/chunked/milestone/tutorial-traversal-java-api.html">framework de traversée</a>, le langage <a href="https://github.com/neo4j-contrib/gremlin-plugin">Gremlin</a> devéloppé par
Tinkerpop</p>
<div class="literalblock">
<div class="content">
<pre>&lt;shamelessPlug&gt; Les http://www.lateral-thoughts.com/formations[formations] ou http://www.brownbaglunch.fr/baggers.html#Florent_Biville[BBL] sont l'occasion d'en parler &lt;/shamelessPlug&gt; .</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_retour_viadeo_implementation_time">Retour à Viadeo : implementation time!</h3>
<div class="paragraph">
<p>Revenons à votre moteur de recommandations. Le genre de questions auquel
vous devez répondre ressemble à "trouver tous les contacts de mes
contacts" ou encore "trouve-moi tous les contacts de mes contacts, qui
connaissent quelqu&#8217;un avec qui j&#8217;ai déjà travaillé". C&#8217;est un point qui
s&#8217;applique bien au delà de Neo4J d&#8217;ailleurs : <strong>avant de pondre un modèle
de données, réfléchissez aux questions auxquelles il doit répondre !</strong></p>
</div>
<div class="paragraph">
<p>Au vu de celles énoncées ci-dessus, un graphe avec les éléments
suivantes pourrait tout à fait faire l&#8217;affaire :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les utilisateurs auront un label CONTACT</p>
</li>
<li>
<p>les entreprises auront un label COMPANY</p>
</li>
<li>
<p>les noeuds ont (pour simplifier) une propriété name qui contient nom
et prénom</p>
</li>
<li>
<p>le fait d'être en contact est matérialisé par
(:CONTACT)-[:IN_CONTACT_WITH]-(:CONTACT)</p>
</li>
<li>
<p>le fait de travailler pour une entreprise s'écrit :
(:CONTACT)-[:WORKED_IN]&#8594;(:COMPANY)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vous décidez donc de commencer par la requête visiblement la plus
simple, à savoir "trouve-moi tous les contacts de mes contacts".</p>
</div>
<div class="paragraph">
<p>Comme votre formateur précédent ne l&#8217;a pas mentionné, vous avez eu
l&#8217;heureuse initiative de consulter la superbe documentation de Neo4J
concernant les
<a href="http://docs.neo4j.org/chunked/stable/cypher-parameters.html">requêtes
paramétrées</a>.</p>
</div>
<div class="paragraph">
<p>Vous arrivez donc à la requête suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher"> MATCH (suggestions:CONTACT)-[:IN_CONTACT_WITH]-(:CONTACT)-[:IN_CONTACT_WITH]-(me:CONTACT)
 WHERE me.name = {name} // {name} est un paramètre nommé, passé à l'exécution
 RETURN me, suggestions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Plutôt expressif, non ? Vous traversez deux relations IN_CONTACT_WITH
pour trouver des suggestions de contact.</p>
</div>
<div class="paragraph">
<p>Oui mais&#8230;&#8203; il subsiste un petit souci que certains d&#8217;entre vous auront
peut-être entrevu. Être un contact avec quelqu&#8217;un sur Viadeo est
bidirectionnel (je suis en contact avec toi donc tu es en contact avec
moi).</p>
</div>
<div class="paragraph">
<p>Mettez-vous donc dans la peau du <em>traversal framework</em> : vous rencontrez
alors un noeud de label CONTACT (appelons-le Alfred), suivez une
première relation IN_CONTACT_WITH qui vous amène à un autre noeud de
label CONTACT (appelons-le Alphonse). Le souci est que rien ne vous
interdit de suivre la même relation dans l&#8217;autre sens et revenir à
Alfred ! Par conséquent, Alfred se retrouve donc comme contact de
contact de lui-même et sera annoncé comme recommandation, ce qui lui
fait une belle jambe à Alfred !</p>
</div>
<div class="paragraph">
<p>Mais ne paniquez pas ! Vous avez plusieurs possibilités (comme
l&#8217;utilisation de
<a href="http://docs.neo4j.org/chunked/milestone/query-aggregation.html#aggregation-distinct">DISTINCT</a>)
ou encore :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher"> MATCH (suggestions:CONTACT)-[:IN_CONTACT_WITH]-(:CONTACT)-[:IN_CONTACT_WITH]-(me:CONTACT)
 WHERE me.name = \{name} AND me &lt;&gt; suggestions +
 RETURN me, suggestions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notez enfin que vous pouvez reformuler le <em>pattern</em> de MATCH de façon à
ce qu&#8217;elle ne référence vraiment que ce qui est utilisé dans la clause
RETURN. Je vais vous présenter une façon de faire et vous laisser
l&#8217;autre comme exercice ;-)</p>
</div>
<div class="paragraph">
<p>Avant de vous montrer cette reformulation, voici la syntaxe complète
d&#8217;une relation comme l&#8217;indique la <a href="http://docs.neo4j.org/chunked/milestone/query-match.html#match-variable-length-relationships">documentation</a>
de Cypher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> [variableName:RELATION_TYPE*minHops..maxHops]</pre>
</div>
</div>
<div class="paragraph">
<p>La partie de gauche est déjà connue. La partie précédée d&#8217;une
astérisque, quant à elle, paraît plus exotique. Elle permet de spécifier
des degrés de séparations (ne pas le spécifier revient à écrire
*1..infinité). Par défaut, vous cherchez une relation d&#8217;un degré au
moins égal à 1 (ami de) ou plus (ami d&#8217;ami d&#8217;ami d&#8217;ami d&#8217;ami&#8230;&#8203;).</p>
</div>
<div class="literalblock">
<div class="content">
<pre> Or, ce que vous voulons, ce sont des contacts de contacts. La requête
peut donc être réécrite comme suit (avec une légère feinte : minHops est
égal à maxHops) :</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cypher" data-lang="cypher"> MATCH (suggestions:CONTACT)-[:IN_CONTACT_WITH***2..2**]-(me:CONTACT) +
 WHERE me.name = \{name} AND me &lt;&gt; suggestions +
 RETURN me, suggestions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dans le cadre de requêtes plus complexes, vous pourriez simplifier la
clause MATCH et imposer le chemin intermédiaire requis dans la clause
WHERE. En effet, si vous n&#8217;avez pas besoin du chemin intermédiaire dans
la clause RETURN c&#8217;est qu&#8217;il n&#8217;est nécessaire qu&#8217;au <em>filtrage</em> c&#8217;est
donc pourquoi la clause WHERE est toute indiquée dans cette situation.</p>
</div>
<div class="paragraph">
<p>Évidemment, cette requête n&#8217;est qu&#8217;une façon de se mettre le pied à
l'étrier. Une fois mis en production, vous vous rendez compte que :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>certains contacts déjà ajoutés apparaissent dans les recommandations</p>
</li>
<li>
<p>le taux d&#8217;acceptation est mitigé, visiblement, il va falloir affiner
les critères de sélection !</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_vers_une_requ_te_mieux_cibl_e">Vers une requête mieux ciblée</h3>
<div class="paragraph">
<p>Et si vous essayiez d&#8217;implémenter la requête de recommandations suivante
"trouve-moi tous les contacts de mes contacts, qui connaissent (sont en
contact avec) quelqu&#8217;un avec qui j&#8217;ai déjà travaillé".</p>
</div>
<div class="paragraph">
<p>Petit rappel du graphe :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>les utilisateurs auront un label CONTACT</p>
</li>
<li>
<p>les entreprises auront un label COMPANY</p>
</li>
<li>
<p>les noeuds ont (pour simplifier) une propriété name qui contient nom
et prénom</p>
</li>
<li>
<p>le fait d'être en contact est matérialisé par <code>(:CONTACT)-[:IN_CONTACT_WITH]-(:CONTACT)</code></p>
</li>
<li>
<p>le fait de travailler pour une entreprise s'écrit : <code>(:CONTACT)-[:WORKED_IN]&#8594;(:COMPANY)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le début de la requête est exactement le même que précédemment : je
récupère les contacts de contacts.</p>
</div>
<div class="paragraph">
<p>À VOUS, MAINTENANT !</p>
</div>
<div class="paragraph">
<p>Promis, je donne <em>une</em> solution dans le prochain article !</p>
</div>
</div>
<div class="sect2">
<h3 id="_le_mot_de_la_fin">Le mot de la fin</h3>
<div class="paragraph">
<p>Nous sommes encore loin d&#8217;avoir implémenté <a href="http://www.reco4j.org/">un
moteur de recommandations</a> digne de ce nom. Néanmoins, vous avez pu
d&#8217;ores et déjà constater que les pré-requis pour jouer avec Neo4J sont
loin d'être insurmontables :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il suffit d&#8217;ouvrir <a href="http://console.neo4j.org" class="bare">http://console.neo4j.org</a> dans votre navigateur favori</p>
</li>
<li>
<p>et écrire quelques requêtes <a href="http://docs.neo4j.org/chunked/2.0.0-M05/cypher-query-lang.html">Cypher</a> pour vous faire la main</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>pour commencer à avoir des retours très rapides. Même pas besoin
d&#8217;installer Neo4J. Une feuille de papier, un crayon et un navigateur
suffisent !</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Non content d'être simple à prototyper, Neo4J est aussi conceptuellement
simple et j&#8217;espère que cette mise en bouche vous en aura convaincu.</p>
</div>
<div class="paragraph">
<p>Pour le prochain article, j&#8217;aborderai Neo4J avec un angle plus technique
afin d'évoquer notamment :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>la représentation des données sur disque</p>
</li>
<li>
<p>la gestion des transactions</p>
</li>
<li>
<p>et sa montée en charge</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>avant d&#8217;expliquer, dans l&#8217;article suivant, comment démarrer un
projet Java avec Neo.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>En attendant, je vais simplement paraphraser
<a href="https://twitter.com/peterneubauer">Peter Neubauer</a> et conclure par :</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If you can write, you can code.
If you can sketch, you can use a graph database.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="_approfondir">Approfondir</h3>
<div class="paragraph">
<p>Rencontres : <a href="http://www.meetup.com/graphdb-france/">Graph DB Paris</a></p>
</div>
<div class="paragraph">
<p>Entraide : <a href="https://groups.google.com/forum/#!forum/neo4jfr">Google Groups Neo4J FR</a></p>
</div>
<div class="paragraph">
<p>Conseil / formation : <a href="http://www.lateral-thoughts.com/">Lateral Thoughts</a>, <a href="http://www.brownbaglunch.fr/baggers.html#Florent_Biville">Brown Bag Lunch</a></p>
</div>
<div class="paragraph">
<p>Un grand merci à Mathilde, Hugo, Pierre-Yves pour leur relecture !</p>
</div>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="" style="background-image: url(https://avatars.githubusercontent.com/u/445792?v=3)"><span class="hidden">@fbiville's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="">@fbiville</a></h4>

                    <p>Read <a href="">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Paris, France</span>
                    <span class="author-link icon-link"><a href="http://florent.biville.net">http://florent.biville.net</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=Neo4j%20%3A%20mais%20qu'est-ce%20aue%20c'est%20%3F&amp;url=https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://fbiville.github.io/2013/10/13/Neo4j-mais-quest-ce-aue-cest.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'fbiville-github-io'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>


    </article>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="https://fbiville.github.io">(10 piece) Puzzler</a> &copy; 2015</section>
        <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
    </footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();      
      </script>

    <script type="text/javascript" src="//fbiville.github.io/themes/Casper/assets/js/jquery.fitvids.js?v=1.0.0"></script>
    <script type="text/javascript" src="//fbiville.github.io/themes/Casper/assets/js/index.js?v=1.0.0"></script>

</body>
</html>
